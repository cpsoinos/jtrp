<% meta @meta_tags %>
<% meta title: "#{@item.description.titleize} - #{@account.try(:full_name)}" %>

<div class="row">
  <div class="col-sm-12 text-center">
    <h1 class="company-title"><%= @item.description.titleize %></h1>
  </div>
</div>

<% if current_user.try(:internal?) %>
  <%= render 'mark_sold_modal', item: @item, redirect_url: request.original_url %>
  <%= render 'new_item_from_batch_modal' %>

  <div class="row text-center">
    <div class="col-md-8 col-md-offset-2 col-xs-10 col-xs-offset-1">
      <%= render 'header_cards' %>
    </div>
  </div>
<% end %>

<div class="section text-center section section-dark">

  <div class="row">
      <div class="col-xs-10 col-xs-offset-1 col-md-4 col-md-offset-1">

        <div class="tab-content">
          <% @item.initial_photos.each do |photo| %>
            <% cache photo do %>
              <div class="tab-pane large-top-margin" id="product-page<%= photo.id %>">
                <%= image_tag(photo.photo_url(client_hints: true, quality: "auto", width: :auto, fetch_format: :auto, dpr: "auto", effect: :improve), class: "img-rounded img-responsive img-raised img-featured") %>
              </div>
            <% end %>
          <% end %>
        </div>

        <ul class="nav flexi-nav top-margin" role="tablist" id="flexiselDemo1">
          <% @item.initial_photos.each do |photo| %>
            <li class="nbs-flexisel-item">
              <a href="#product-page<%= photo.id %>" role="tab" data-toggle="tab" aria-expanded="false" class="img-tab">
                <%= image_tag(photo.photo_url(:small_thumb), class: "img-rounded img-responsive img-raised") %>
              </a>
            </li>
          <% end %>
        </ul>
      </div>

    <div class="col-xs-10 col-xs-offset-1 col-md-4">
      <div class="card card-pricing">
        <div class="content">
          <% if current_user.try(:internal?) %>
            <span class="hidden-print">
              <%= link_to "<i class='material-icons'>edit</i>".html_safe, edit_account_job_proposal_item_path(@item.account, @item.job, @item.proposal, @item), class: "btn btn-fab btn-fab-mini btn-primary pull-left" %>
            </span>
            <span class="hidden-print">
              <%= link_to "<i class='material-icons'>delete_forever</i>".html_safe, item_path(@item), method: :delete, class: "btn btn-fab btn-fab-mini btn-danger pull-right", data: {confirm: "Are you sure?", :'confirm-button-text' => "Yes, I'm sure", :'cancel-button-text' => "No, cancel!", :'sweet-alert-type' => 'warning', :'confirm-button-color' => '#f44336', text: "This will delete the item. This is irreversable."} %>
            </span>
          <% end %>
          <h6 class="category text-success"><%= @item.description %></h6>
          <% if @item.listing_price_cents %>
            <h1 class="card-title"><small>$</small><%= humanized_money(@item.listing_price) %></h1>
          <% end %>
          <% if current_user.try(:internal?) %>
            <ul>
              <li>No. <%= @item.account_item_number %></li>
              <li>SKU <%= @item.id %></li>
              <li><%= @item.ownership_type %></li>
              <% if @item.consigned? %>
                <li>at <%= @item.consignment_rate %>%</li>
              <% end %>
              <li>Min. Price: <%= humanized_money_with_symbol(@item.minimum_sale_price) %></li>
              <li>
                <%= @item.status.titleize %>
                <% if @item.sold? %>
                  for <%= humanized_money_with_symbol(@item.sale_price) %> on <%= @item.sold_at.strftime('%-m/%-d/%y') %>
                <% end %>
              </li>
            </ul>
            <% unless @item.sold? %>
              <button type="button" class="btn btn-raised btn-primary btn-round" data-toggle="modal" data-target="#mark-sold-modal" data-item-id="<%= @item.id %>" data-item-description="<%= @item.description %>">
                Mark as Sold <i class='material-icons'>done</i>
              </button>
            <% end %>
            <button type="button" class="btn btn-raised btn-notice btn-round" data-toggle="modal" data-target="#new-item-from-batch-modal">
              Create Item from this Batch <i class='material-icons'>content_copy</i>
            </button>
            <% if @item.potential? || @item.inactive? %>
              <%= link_to "Mark Active <i class='material-icons'>store</i>".html_safe, item_activate_path(@item), class: "btn btn-raised btn-info btn-round", method: :post %>
            <% elsif @item.active? %>
              <%= link_to "Mark Inactive <i class='material-icons'>remove_circle</i>".html_safe, item_deactivate_path(@item), class: "btn btn-raised btn-danger btn-round", method: :post %>
            <% end %>
          <% end %>

          <% if current_user.try(:internal?) && @item.child? %>
            <div class="card card-plain card-blog">
              <h4>This item was created from this batch:</h4>
              <a href="<%= account_job_proposal_item_path(@item.account, @item.job, @item.proposal, @item.parent_item) %>">
                <div class="card-image">
                    <%= image_tag(@item.parent_item.featured_photo.photo_url(client_hints: true, quality: "auto", fetch_format: :auto, width: :auto, dpr: "auto", effect: :improve), class: "img img-raised") %>
                  <div class="ripple-container"></div>
                </div>
              </a>

              <div class="content">
                <%= link_to "<i class='material-icons'>edit</i>".html_safe, edit_account_job_proposal_item_path(@item.account, @item.job, @item.proposal, @item.parent_item), class: "btn btn-fab btn-fab-mini btn-primary pull-right" %>
                <h6 class="category text-info"><%= @item.parent_item.ownership_type %></h6>
                <h4 class="card-title">
                  <%= link_to @item.parent_item.description, account_job_proposal_item_path(@item.account, @item.job, @item.proposal, @item.parent_item) %>
                </h4>
              </div>
            </div>
          <% end %>

          <div class="fb-like" data-href="<%= item_url(@item) %>" data-layout="standard" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>
        </div>
      </div>

      <div class="card card-pricing">
        <div class="fb-comments" data-href="<%= item_url(@item) %>" data-numposts="5" data-width="100%"></div>
      </div>

    </div>

  </div>
</div>
